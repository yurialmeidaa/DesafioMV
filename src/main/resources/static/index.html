<!doctype html>
<html lang="en">
  <head>
  
  <meta http-equiv="Refresh" content="2; url=public/index.html" />
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>Café da manhã</title>
  </head>
  <body>
    <h1>Café da manhã</h1>

    <!-- Optional JavaScript; choose one of the two! -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->
    
    
    <form action="" id="formCadastro">
    
    <div class="mb-3">
  <label for="id" class="form-label">ID</label>
  <input type="text" class="form-control" id="id" readonly="readonly">
</div>
    
    
    <div class="mb-3">
  <label for="nome" class="form-label">Nome colaborador</label>
  <input type="text" class="form-control" id="nome" placeholder="">
</div>
<div class="mb-3">
  <label for="cpf" class="form-label">CPF colaborador</label>
  <input type="text" class="form-control" id="cpf" placeholder="">
</div>
<div class="mb-3">
  <label for="refeicao" class="form-label">Refeição</label>
  
  <select class="form-select" aria-label="Default select example" id="refeicao">
  <option selected>Selecione uma refeiçao</option>
  <option value="BOLO">Bolo</option>
  <option value="SUCO">Suco</option>
  <option value="PAO">Pão</option>
  <option value="PAO_DE_QUEIJO">Pão de queijo</option>
  <option value="TORRADA">Torrada</option>
  <option value="FRIOS">Frios</option>
  <option value="CAFE">Café</option>
  <option value="LEITE">Leite</option>

</select>
  
  
</div>
    </form>
    <button type="button" class="btn btn-success" onclick="salvarUsuario()">Salvar</button>
    <button type="button" class="btn btn-primary" onclick="document.getElementById('formCadastro').reset()">Novo</button>

    <br>
    <br>
            
          <table border="1" cellspacing="0" cellpadding="5">
<tr>
<th>Id</th>
<th>Nome</th>
<th>CPF</th>
<th>Refeição</th>
</tr>
</table>
    
    
   
    
    
    
    <script type="text/javascript">
    
    $(document).ready(function() {

    	 
		$.getJSON('listaTodos', function(json) {
			  var tr=[];
				for (var i = 0; i < json.length; i++) {
				tr.push('<tr id="'+json[i].id+'">');
				tr.push('<td>' + json[i].id + '</td>');
				tr.push('<td>' + json[i].nome + '</td>');
				tr.push('<td>' + json[i].cpf + '</td>');
				tr.push('<td>' + json[i].refeicao + '</td>');
				tr.push('<td><button class="btn btn-warning" onclick="colocarEditar('+json[i].id+')">Editar</button>&nbsp;&nbsp;<button class="btn btn-danger" onclick="deleteUser('+json[i].id+')">Deletar</button></td>');
				tr.push('</tr>');
				}
				$('table').append($(tr.join('')));
		});
		
		
	
		
		
		
		
		});
    
    
    
    
    function salvarUsuario(){
    	
    	var id = $("#id").val();
    	var nome = $("#nome").val();
    	var cpf =$("#cpf").val();
    	var refeicao =$("#refeicao").val();
    	
    	$.ajax({
    		  type: "POST",
    		  url: "salvar",
    		  data: JSON.stringify({id : id, nome : nome, cpf : cpf, refeicao : refeicao}),
    		  contentType: "application/json; charset=utf-8",
    		  success: function (response){
    			  
    			  $("#id").val(response.id);
    			  alert("Salvo com sucesso!");
    			  document.location.reload(true);
    			  
    		  }
    		  }).fail(function(xhr, status, errorThrown){
    			  alert("CPF já cadastrado: " + xhr.responseText);
    				  
    		});
    	
    }
    
    function colocarEditar(id){
    	$.ajax({
  		  type: "GET",
  		  url: "buscarId",
  		  data: "iduser=" + id,
  		  success: function(response){
  			  
  			$("#id").val(response.id);
  	    	$("#nome").val(response.nome);
  	    	$("#cpf").val(response.cpf);
  	    	$("#refeicao").val(response.refeicao);
  			  
  	    	
  			 
  		  }
  		  }).fail(function(xhr, status, errorThrown){
  			  alert("Erro ao editar: " + xhr.responseText);
  				  
  		});
    }
    	
    	function deleteUser(id){
    		$.ajax({
    	  		  type: "DELETE",
    	  		  url: "delete",
    	  		  data: "iduser=" + id ,
    	  		  success: function(response){
    	  			  $('#' + id).remove();
    	  			  
    	  			alert(response);
    	  			  
    	  	    	
    	  			 
    	  		  }
    	  		  }).fail(function(xhr, status, errorThrown){
    	  			  alert("Erro ao deletar usuario por id: " + xhr.responseText);
    	  				  
    	  		});
    	}
    
    
    
    </script>
  </body>
</html>